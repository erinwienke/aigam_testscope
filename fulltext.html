<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Full Text â€“ AIGAM Test</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<nav>
    <a href="index.html">Home</a>
    <a href="scope.html">Test Scope</a>
    <a href="plan.html">Test Plan</a>
    <a href="phaseone.html">Phase 1: Backend Integration + External Systems</a>
    <a href="phasetwo.html">Phase 2: Middleware Integration</a>
    <a href="phasethree.html">Phase 3: Frontend Integration</a>
    <a href="phasefour.html">Phase 4: Validation + Full System</a>
    <a href="fulltext.html">Full Text</a>
</nav>
<div class="container">
    <h1>AIGAM Test</h1>
    <h2>Full Text</h2>

    <div id="testScope"></div>
    <div id="testPlan"></div>
    <div id="phase1"></div>
    <div id="phase2"></div>
    <div id="phase3"></div>
    <div id="phase4"></div>

    <script>
  const includes = [
    { file: 'scope.html',     elementId: 'testScope', elevate: true  },
    { file: 'plan.html',      elementId: 'testPlan',  elevate: true  },
    { file: 'phaseone.html',  elementId: 'phase1',    elevate: false },
    { file: 'phasetwo.html',  elementId: 'phase2',    elevate: false },
    { file: 'phasethree.html',elementId: 'phase3',    elevate: false },
    { file: 'phasefour.html', elementId: 'phase4',    elevate: false },
  ];

  // ðŸ”¹ Tracks which H1 texts weâ€™ve already used somewhere
  const seenH1Headings = new Set();

  // OPTIONAL: if you want the main fulltext.html's <h1> to count as â€œfirstâ€
  // (e.g., AIGAM Test, Full Text), seed from existing H1s:
  document.querySelectorAll("h1").forEach(h => {
    const key = h.textContent.trim();
    if (key) seenH1Headings.add(key);
  });

  includes.forEach(({ file, elementId, elevate }) => {
    fetch(file)
      .then(res => res.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");

        const container = doc.querySelector(".container");
        if (!container) {
          console.warn(`${file} has no .container div`);
          return;
        }

        const clone = container.cloneNode(true);

        // 1ï¸âƒ£ REMOVE ONLY DUPLICATE H1s (first occurrence wins)
        clone.querySelectorAll("h1").forEach(h => {
          const key = h.textContent.trim();
          if (!key) return;

          if (seenH1Headings.has(key)) {
            // We've already seen this H1 text in an earlier file â†’ drop it here
            h.remove();
          } else {
            // First time we see this H1 text (in includes order) â†’ keep it
            seenH1Headings.add(key);
          }
        });

        // 2ï¸âƒ£ ELEVATE HEADINGS (ONLY for scope + plan)
        if (elevate) {
          const headings = Array.from(
            clone.querySelectorAll("h1, h2, h3, h4, h5, h6")
          );

          if (headings.length > 0) {
            // Find smallest level present: e.g., h2 => 2, h3 => 3
            const minLevel = Math.min(
              ...headings.map(h => parseInt(h.tagName[1], 10))
            );

            const shift = minLevel - 1; // h2 => shift=1 so h2â†’h1, h3â†’h2, etc.

            if (shift > 0) {
              headings.forEach(h => {
                const oldLevel = parseInt(h.tagName[1], 10);
                let newLevel = oldLevel - shift;
                if (newLevel < 1) newLevel = 1;

                const newTag = document.createElement("h" + newLevel);

                // Copy attributes
                for (const attr of h.attributes) {
                  newTag.setAttribute(attr.name, attr.value);
                }
                // Preserve inner content
                newTag.innerHTML = h.innerHTML;

                h.replaceWith(newTag);
              });
            }
          }
        }

        // 3ï¸âƒ£ Inject the processed HTML into the combined page
        document.getElementById(elementId).innerHTML = clone.innerHTML;
      })
      .catch(err => console.error(`Error loading ${file}:`, err));
  });
</script>
</div>
</body>

</html>

